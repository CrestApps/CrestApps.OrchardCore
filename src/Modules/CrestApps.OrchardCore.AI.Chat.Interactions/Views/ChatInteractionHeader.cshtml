@using CrestApps.OrchardCore.AI.Chat.Interactions.Core
@using CrestApps.OrchardCore.AI.Core
@using CrestApps.OrchardCore.AI.Chat.Interactions.ViewModels
@using Microsoft.AspNetCore.Authorization
@using Microsoft.Extensions.Options

@inject IAuthorizationService AuthorizationService
@inject IOptions<AIOptions> AIOptions

@model ChatInteractionCapsuleViewModel

@if (!AIOptions.Value.ProfileSources.TryGetValue(Model.Interaction.Source, out var source))
{
    return;
}

<div class="card text-bg-theme">
    <div class="card-body d-flex justify-content-between flex-wrap gap-2">

        <div>
            <button type="button" class="btn btn-outline-danger me-1" id="clearHistoryBtn" data-interaction-id="@Model.Interaction.ItemId" title="@T["Clear chat history while keeping documents, parameters, and tools"]" @(Model.Interaction.Prompts?.Count > 0 ? "" : "style=display:none;")>
                <i class="fa-solid fa-eraser"></i> @T["Clear History"]
            </button>
        </div>

        <div class="d-flex flex-wrap gap-2">

            <div class="btn-group" title="Actions">
                <button type="button" class="btn btn-sm btn-secondary dropdown-toggle actions" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span>@T["New Chat"]</span>
                </button>
                <ul class="actions-menu dropdown-menu dropdown-menu-end">

                    <li>
                        <a class="dropdown-item" asp-action="New" asp-controller="Admin" asp-route-source="@Model.Interaction.Source" asp-area="@ChatInteractionsConstants.Feature.ChatInteractions">
                            <i class="fa-solid fa-plus"></i> @T["Empty Chat"]
                        </a>
                    </li>

                    <li>
                        <a class="dropdown-item" asp-action="Clone" asp-controller="Admin" asp-route-itemId="@Model.Interaction.ItemId" asp-area="@ChatInteractionsConstants.Feature.ChatInteractions">
                            <i class="fa-solid fa-plus"></i> @T["Chat with Preset Settings"]
                        </a>
                    </li>

                </ul>
            </div>

            <a class="btn btn-primary" asp-action="Index" asp-controller="Admin" asp-area="@ChatInteractionsConstants.Feature.ChatInteractions">
                <i class="fa-solid fa-list"></i> @T["Chat Interactions"]
            </a>
        </div>
    </div>
</div>

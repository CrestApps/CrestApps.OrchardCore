function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regenerator(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return _regeneratorDefine2(l,"_invoke",function(n,r,o){var a,s,c,l=0,u=o||[],d=!1,h={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,s=0,c=e,h.n=n,i}};function m(n,r){for(s=n,c=r,t=0;!d&&l&&!o&&t<u.length;t++){var o,a=u[t],m=h.p,f=a[2];n>3?(o=f===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(s=0,h.v=r,h.n=a[1]):m<f&&(o=n<3||a[0]>r||r>f)&&(a[4]=n,a[5]=r,h.n=f,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),s=u,c=f;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(h.n=-1),m(s,c)):h.n=c:h.v=c);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=h.n<0)?c:n.call(r,h))!==i)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,o,a),!0),l}var i={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),d=l.prototype=s.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=l,_regeneratorDefine2(d,"constructor",l),_regeneratorDefine2(l,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(l,o,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,o,"Generator"),_regeneratorDefine2(d,r,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:h}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,t,n,r){function a(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){asyncGeneratorStep(a,r,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,r,o,i,s,"throw",e)}i(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}window.chatInteractionManager=function(){var e={generatedImageAltText:"Generated Image",generatedImageMaxWidth:400,generatedChartMaxWidth:900,downloadImageTitle:"Download image",downloadChartTitle:"Download chart as image",downloadChartButtonText:"Download",messageTemplate:'\n            <div class="ai-chat-messages">\n                <div v-for="(message, index) in messages" :key="index" class="ai-chat-message-item">\n                    <div>\n                        <div v-if="message.role === \'user\'" class="ai-chat-msg-role ai-chat-msg-role-user">You</div>\n                        <div v-else-if="message.role !== \'indicator\'" class="ai-chat-msg-role ai-chat-msg-role-assistant">\n                            <i :class="\'fa fa-robot\' + (message.isStreaming ? \' ai-streaming-icon\' : \' ai-bot-icon\')"></i>\n                            Assistant\n                        </div>\n                        <div class="lh-base">\n                            <h4 v-if="message.title">{{ message.title }}</h4>\n                            <div v-html="message.htmlContent || message.content"></div>\n                            <span class="message-buttons-container" v-if="!isIndicator(message)">\n                                <button class="btn btn-sm btn-link text-secondary p-0 button-message-toolbox" @click="copyResponse(message.content)" title="Click here to copy response to clipboard.">\n                                    <i class="fa-solid fa-copy"></i>\n                                </button>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',indicatorTemplate:'\n            <div class="ai-chat-msg-role ai-chat-msg-role-assistant">\n                <i class="fa fa-robot ai-streaming-icon" style="display: inline-block;"></i>\n                Assistant\n            </div>\n        ',untitledText:"Untitled",clearHistoryTitle:"Clear History",clearHistoryMessage:"Are you sure you want to clear the chat history? This action cannot be undone. Your documents, parameters, and tools will be preserved.",clearHistoryOkText:"Yes",clearHistoryCancelText:"Cancel"},t=new marked.Renderer;t.link=function(e){return'<a href="'.concat(e.href,'" target="_blank" rel="noopener noreferrer">').concat(e.text,"</a>")},t.code=function(e){var t=e.text||"",n=(e.lang||"").trim(),r=t;if("undefined"!=typeof hljs)if(n&&hljs.getLanguage(n))try{r=hljs.highlight(t,{language:n}).value}catch(e){}else try{r=hljs.highlightAuto(t).value}catch(e){}else r=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var o=n?' data-lang="'.concat(n,'"'):"";return"<pre".concat(o,'><button type="button" class="ai-code-copy-btn" title="Copy code"><i class="fa-solid fa-copy"></i></button><code class="hljs').concat(n?" language-"+n:"",'">').concat(r,"</code></pre>")},t.image=function(t){var n=t.href,r=t.text||e.generatedImageAltText,o=e.generatedImageMaxWidth;return'<div class="generated-image-container">\n            <img src="'.concat(n,'" alt="').concat(r,'" class="img-thumbnail" style="max-width: ').concat(o,'px; height: auto;" />\n            <div class="mt-2">\n                <a href="').concat(n,'" target="_blank" download="').concat(r,'" title="').concat(e.downloadImageTitle,'" class="btn btn-sm btn-outline-secondary ai-download-image">\n                    <i class="fa-solid fa-download"></i>\n                </a>\n            </div>\n        </div>')};var n=0,r=[];function o(e){if(e&&e._pendingCharts&&e._pendingCharts.length){var t,n=_createForOfIteratorHelper(e._pendingCharts);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=document.getElementById(r.chartId);if(o)if("undefined"!=typeof Chart)try{var a;o._chartInstance&&o._chartInstance.destroy();var i="string"==typeof r.config?JSON.parse(r.config):r.config;null!==(a=i.options)&&void 0!==a||(i.options={}),i.options.responsive=!0,i.options.maintainAspectRatio=!1,o._chartInstance=new Chart(o,i)}catch(e){console.error("Error creating chart:",e)}else console.error("Chart.js is not available on the page.")}}catch(e){n.e(e)}finally{n.f()}e._pendingCharts=[]}}function a(e,n){r=[];var o=marked.parse(e,{renderer:t});return n._pendingCharts=r.length>0?_toConsumableArray(r):[],o}marked.use({extensions:[{name:"chart",level:"block",start:function(e){var t=e.indexOf("[chart:");return t>=0?t:void 0},tokenizer:function(e){var t=function(e){var t="[chart:",n=e.indexOf(t);if(n<0)return null;var r=n+t.length,o=r;for(;o<e.length&&(" "===e[o]||"\n"===e[o]||"\r"===e[o]||"\t"===e[o]);)o++;if(o>=e.length||"{"!==e[o])return null;for(var a=0,i=!1,s=!1;o<e.length;o++){var c=e[o];if(i){if(s){s=!1;continue}if("\\"===c){s=!0;continue}'"'===c&&(i=!1)}else if('"'!==c){if("{"===c)a++;else if("}"===c&&0===--a){var l=o,u=e.indexOf("]",l+1);return u<0?null:{startIndex:n,endIndex:u+1,json:e.substring(r,l+1).trim()}}}else i=!0}return null}(e);if(t&&0===t.startIndex){var r="chat_chart_".concat(++n);return{type:"chart",raw:e.substring(0,t.endIndex),chartId:r,json:t.json}}},renderer:function(t){return r.push({chartId:t.chartId,config:t.json}),n=t.chartId,o=e.generatedChartMaxWidth,'<div class="chart-container" style="position: relative; width: 100%; max-width: '.concat(o,'px; margin: 0 auto; height: 480px;">')+'<canvas id="'.concat(n,'" class="img-thumbnail" width="').concat(o,'" height="480" style="width: 100%; height: 480px;"></canvas>')+'</div><div class="mt-2">'+'<button type="button" class="btn btn-sm btn-outline-secondary" onclick="downloadChart(\''.concat(n,'\')" title="').concat(e.downloadChartTitle,'">')+'<i class="fa-solid fa-download"></i> '.concat(e.downloadChartButtonText)+"</button></div>";var n,o}}]});return{initialize:function(t){var n=Object.assign({},e,t);if(e=n,n.signalRHubUrl)if(n.appElementSelector)if(n.chatContainerElementSelector)if(n.inputElementSelector){if(n.sendButtonElementSelector)return Vue.createApp({data:function(){return{inputElement:null,buttonElement:null,chatContainer:null,placeholder:null,isInteractionStarted:!1,isPlaceholderVisible:!0,isStreaming:!1,isNavigatingAway:!1,autoScroll:!0,stream:null,messages:[],prompt:"",initialFieldValues:new Map,settingsDirty:!1,saveSettingsTimeout:null}},methods:{handleBeforeUnload:function(){this.isNavigatingAway=!0},startConnection:function(){var e=this;return _asyncToGenerator(_regenerator().m(function t(){var r;return _regenerator().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.connection=(new signalR.HubConnectionBuilder).withUrl(n.signalRHubUrl).withAutomaticReconnect().build(),e.connection.serverTimeoutInMilliseconds=6e5,e.connection.keepAliveIntervalInMilliseconds=15e3,e.connection.on("LoadInteraction",function(t){var n;e.initializeInteraction(t.itemId,!0),e.messages=[];var r=document.querySelector('input[name="ChatInteraction.Title"]');r&&t.title&&(r.value=t.title),(null!==(n=t.messages)&&void 0!==n?n:[]).forEach(function(t){e.addMessage(t),e.$nextTick(function(){o(t)})})}),e.connection.on("SettingsSaved",function(e,t){var r=document.querySelector('.chat-interaction-history-item[data-interaction-id="'.concat(e,'"]'));r&&(r.textContent=t||n.untitledText)}),e.connection.on("ReceiveError",function(e){console.error("SignalR Error: ",e)}),e.connection.on("HistoryCleared",function(t){e.messages=[],e.showPlaceholder();var n=document.getElementById("clearHistoryBtn");n&&n.classList.add("d-none")}),e.connection.onreconnecting(function(){console.warn("SignalR: reconnecting...")}),e.connection.onreconnected(function(){console.info("SignalR: reconnected.")}),e.connection.onclose(function(t){e.isNavigatingAway||t&&console.warn("SignalR connection closed with error:",t.message||t)}),t.p=1,t.n=2,e.connection.start();case 2:t.n=4;break;case 3:t.p=3,r=t.v,console.error("SignalR Connection Error: ",r);case 4:return t.a(2)}},t,null,[[1,3]])}))()},addMessageInternal:function(e){var t=this;this.fireEvent(new CustomEvent("addingChatInteractionMessage",{detail:{message:e}})),this.messages.push(e),this.$nextTick(function(){t.fireEvent(new CustomEvent("addedChatInteractionMessage",{detail:{message:e}}))})},addMessage:function(e){var t=this;if(e.content){var n=e.content.trim();if(e.references&&"object"===_typeof(e.references)&&Object.keys(e.references).length){for(var r=0,i=Object.entries(e.references);r<i.length;r++){var s=_slicedToArray(i[r],2),c=s[0],l=s[1];n=n.replaceAll(c,"<sup><strong>".concat(l.index,"</strong></sup>"))}n=n.replaceAll("</strong></sup><sup>","</strong></sup><sup>,</sup><sup>"),n+="<br><br>";for(var u=0,d=Object.values(e.references);u<d.length;u++){var h=d[u],m=h.text||"[doc:".concat(h.index,"]");n+=h.link?"**".concat(h.index,"**. [").concat(m,"](").concat(h.link,")<br>"):"**".concat(h.index,"**. ").concat(m,"<br>")}}e.content=n,e.htmlContent=a(n,e)}this.addMessageInternal(e),this.hidePlaceholder(),this.$nextTick(function(){o(e),t.scrollToBottom()})},hidePlaceholder:function(){this.placeholder&&this.placeholder.classList.add("d-none"),this.isPlaceholderVisible=!1},showPlaceholder:function(){this.placeholder&&this.placeholder.classList.remove("d-none"),this.isPlaceholderVisible=!0},fireEvent:function(e){document.dispatchEvent(e)},isIndicator:function(e){return"indicator"===e.role},sendMessage:function(){var e=this;return _asyncToGenerator(_regenerator().m(function t(){var n,r;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(n=e.prompt.trim()){t.n=1;break}return t.a(2);case 1:return t.n=2,e.flushPendingSave();case 2:e.addMessage({role:"user",content:n}),(r=document.getElementById("clearHistoryBtn"))&&r.classList.remove("d-none"),e.streamMessage(n),e.inputElement.value="",e.prompt="";case 3:return t.a(2)}},t)}))()},streamMessage:function(e){var t=this;this.stream&&(this.stream.dispose(),this.stream=null),this.streamingStarted(),this.showTypingIndicator(),this.autoScroll=!0;var n="",r={},i=this.messages.length,s=this.getItemId();this.stream=this.connection.stream("SendMessage",s,e).subscribe({next:function(e){var c=t.messages[i];if(!c){e.sessionId&&!s&&t.setItemId(e.sessionId),t.hideTypingIndicator(),i=t.messages.length;var l={role:"assistant",content:"",htmlContent:"",isStreaming:!0};t.messages.push(l),c=l}if(e.references&&"object"===_typeof(e.references)&&Object.keys(e.references).length)for(var u=0,d=Object.entries(e.references);u<d.length;u++){var h=_slicedToArray(d[u],2),m=h[0],f=h[1];r[m]=f}if(e.content){for(var g=e.content,v=0,p=Object.entries(r);v<p.length;v++){var y=_slicedToArray(p[v],2),b=y[0],S=y[1];g=g.replaceAll(b,"<sup><strong>".concat(S.index,"</strong></sup>"))}n+=g.replaceAll("</strong></sup><sup>","</strong></sup><sup>,</sup><sup>")}c.content=n,c.htmlContent=a(n,c),t.messages[i]=c,t.$nextTick(function(){o(c),t.scrollToBottom()})},complete:function(){var e;t.processReferences(r,i),t.streamingFinished();var n=t.messages[i];n&&(n.isStreaming=!1),n&&n.content||t.hideTypingIndicator(),null===(e=t.stream)||void 0===e||e.dispose(),t.stream=null},error:function(e){var n;t.processReferences(r,i),t.streamingFinished();var o=t.messages[i];o&&(o.isStreaming=!1),t.hideTypingIndicator(),t.isNavigatingAway||t.addMessage(t.getServiceDownMessage()),null===(n=t.stream)||void 0===n||n.dispose(),t.stream=null,console.error("Stream error:",e)}})},getServiceDownMessage:function(){return{role:"assistant",content:"Our service is currently unavailable. Please try again later. We apologize for the inconvenience.",htmlContent:""}},processReferences:function(e,t){if(Object.keys(e).length){var n,r=this.messages[t];r.content=(null===(n=r.content)||void 0===n?void 0:n.trim())+"<br><br>"||"";for(var o=0,i=Object.values(e);o<i.length;o++){var s=i[o],c=s.text||"[doc:".concat(s.index,"]");r.content+=s.link?"**".concat(s.index,"**. [").concat(c,"](").concat(s.link,")<br>"):"**".concat(s.index,"**. ").concat(c,"<br>")}r.htmlContent=a(r.content,r),this.messages[t]=r,this.scrollToBottom()}},streamingStarted:function(){var e=this.buttonElement.getAttribute("data-stop-icon");e&&(this.buttonElement.innerHTML=e)},streamingFinished:function(){var e=this.buttonElement.getAttribute("data-start-icon");if(e&&(this.buttonElement.innerHTML=e),this.chatContainer)for(var t=this.chatContainer.querySelectorAll(".ai-streaming-icon"),n=0;n<t.length;n++)t[n].classList.remove("ai-streaming-icon"),t[n].classList.add("ai-bot-icon");for(n=0;n<this.messages.length;n++)this.messages[n].isStreaming&&(this.messages[n].isStreaming=!1);this.settingsDirty&&this.debouncedSaveSettings()},showTypingIndicator:function(){this.addMessage({role:"indicator",htmlContent:n.indicatorTemplate})},hideTypingIndicator:function(){var e=this.messages.length;return this.messages=this.messages.filter(function(e){return"indicator"!==e.role}),e-this.messages.length},scrollToBottom:function(){var e=this;this.autoScroll&&setTimeout(function(){e.chatContainer.scrollTop=e.chatContainer.scrollHeight-e.chatContainer.clientHeight},50)},handleUserInput:function(e){this.prompt=e.target.value},getItemId:function(){return this.inputElement.getAttribute("data-interaction-id")},setItemId:function(e){this.inputElement.setAttribute("data-interaction-id",e||"")},resetInteraction:function(){this.setItemId(""),this.isInteractionStarted=!1,this.messages=[],this.showPlaceholder()},initializeApp:function(){var e=this;this.inputElement=document.querySelector(n.inputElementSelector),this.buttonElement=document.querySelector(n.sendButtonElementSelector),this.chatContainer=document.querySelector(n.chatContainerElementSelector),this.placeholder=document.querySelector(n.placeholderElementSelector),this.chatContainer.addEventListener("scroll",function(){if(e.stream){var t=e.chatContainer.scrollHeight-e.chatContainer.clientHeight-e.chatContainer.scrollTop<=30;e.autoScroll=t}}),this.inputElement.addEventListener("keyup",function(t){null==e.stream&&("Enter"!==t.key||t.shiftKey||e.buttonElement.click())}),this.inputElement.addEventListener("input",function(t){e.handleUserInput(t),t.target.value.trim()?e.buttonElement.removeAttribute("disabled"):e.buttonElement.setAttribute("disabled",!0)}),this.inputElement.addEventListener("paste",function(t){setTimeout(function(){e.prompt=e.inputElement.value,e.inputElement.value.trim()?e.buttonElement.removeAttribute("disabled"):e.buttonElement.setAttribute("disabled",!0)},0)}),this.buttonElement.addEventListener("click",function(){if(null==e.stream)e.sendMessage();else if(e.stream.dispose(),e.stream=null,e.streamingFinished(),e.hideTypingIndicator(),e.messages.length>0){var t=e.messages[e.messages.length-1];"assistant"!==t.role||t.content?t.isStreaming&&(t.isStreaming=!1):e.messages.pop()}});for(var t=document.getElementsByClassName("chat-interaction-history-item"),r=0;r<t.length;r++)t[r].addEventListener("click",function(t){t.preventDefault();var n=t.target.getAttribute("data-interaction-id");n?e.loadInteraction(n):console.error("An element with the class chat-interaction-history-item with no data-interaction-id set.")});for(var o=0;o<n.messages.length;o++)this.addMessage(n.messages[o]);this.chatContainer&&this.chatContainer.addEventListener("click",function(e){var t=e.target.closest(".ai-code-copy-btn");if(t){var n=t.closest("pre");if(n){var r=n.querySelector("code");r&&navigator.clipboard.writeText(r.textContent)}}}),document.querySelectorAll('input[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["]), select[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["]), textarea[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["])').forEach(function(t){var n="checkbox"===t.type,r="SELECT"===t.tagName;n||r?t.addEventListener("change",function(){e.settingsDirty=!0,e.debouncedSaveSettings()}):(t.addEventListener("focus",function(){e.initialFieldValues.set(t,t.value)}),t.addEventListener("blur",function(){var n=e.initialFieldValues.get(t);void 0!==n&&t.value!==n&&(e.settingsDirty=!0,e.debouncedSaveSettings()),e.initialFieldValues.delete(t)}))}),document.querySelectorAll('input[type="checkbox"][name$="].IsSelected"][name^="ChatInteraction.Tools["]').forEach(function(t){t.addEventListener("change",function(){e.settingsDirty=!0,e.debouncedSaveSettings()})}),document.querySelectorAll('input[type="checkbox"].group-toggle').forEach(function(t){t.addEventListener("change",function(){e.settingsDirty=!0,e.debouncedSaveSettings()})}),document.querySelectorAll('input[type="checkbox"][name$="].IsSelected"][name^="ChatInteraction.Connections["]').forEach(function(t){t.addEventListener("change",function(){e.settingsDirty=!0,e.debouncedSaveSettings()})});var a=document.getElementById("clearHistoryBtn");a&&a.addEventListener("click",function(){var t=a.getAttribute("data-interaction-id");t&&e.clearHistory(t)})},loadInteraction:function(e){this.connection.invoke("LoadInteraction",e).catch(function(e){return console.error(e)})},clearHistory:function(e){var t=this;confirmDialog({title:n.clearHistoryTitle,message:n.clearHistoryMessage,okText:n.clearHistoryOkText,cancelText:n.clearHistoryCancelText,callback:function(n){n&&(t.stream&&(t.stream.dispose(),t.stream=null,t.hideTypingIndicator(),t.streamingFinished()),t.connection.invoke("ClearHistory",e).catch(function(e){return console.error("Error clearing history:",e)}))}})},debouncedSaveSettings:function(){var e=this;this.saveSettingsTimeout&&clearTimeout(this.saveSettingsTimeout),this.stream||(this.saveSettingsTimeout=setTimeout(function(){e.settingsDirty&&(e.saveSettings(),e.settingsDirty=!1),e.saveSettingsTimeout=null},850))},getSelectedToolNames:function(){var e=[];return document.querySelectorAll('input[type="checkbox"][name$="].IsSelected"][name^="ChatInteraction.Tools["]:checked').forEach(function(t){var n=t.name.replace(".IsSelected",".ItemId"),r=document.querySelector('input[type="hidden"][name="'.concat(n,'"]'));r&&r.value&&e.push(r.value)}),e},getSelectedMcpConnectionIds:function(){var e=[];return document.querySelectorAll('input[type="checkbox"][name$="].IsSelected"][name^="ChatInteraction.Connections["]:checked').forEach(function(t){var n=t.name.replace(".IsSelected",".ItemId"),r=document.querySelector('input[type="hidden"][name="'.concat(n,'"]'));r&&r.value&&e.push(r.value)}),e},saveSettings:function(){var e=this.getItemId();if(!e)return Promise.resolve();var t={};return document.querySelectorAll('input[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["]), select[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["]), textarea[name^="ChatInteraction."]:not([name*=".Tools["]):not([name*=".Connections["])').forEach(function(e){var n=e.name.replace("ChatInteraction.",""),r=n.charAt(0).toLowerCase()+n.slice(1);"checkbox"===e.type?t[r]=e.checked:"number"===e.type?t[r]=e.value?parseFloat(e.value):null:t[r]=e.value||null}),t.toolNames=this.getSelectedToolNames(),t.mcpConnectionIds=this.getSelectedMcpConnectionIds(),this.connection.invoke("SaveSettings",e,t).catch(function(e){return console.error("Error saving settings:",e)})},flushPendingSave:function(){return this.saveSettingsTimeout&&(clearTimeout(this.saveSettingsTimeout),this.saveSettingsTimeout=null),this.settingsDirty?(this.settingsDirty=!1,this.saveSettings()):Promise.resolve()},initializeInteraction:function(e,t){this.isInteractionStarted&&!t||(this.fireEvent(new CustomEvent("initializingChatInteraction",{detail:{itemId:e}})),this.setItemId(e),this.isInteractionStarted=!0)},copyResponse:function(e){navigator.clipboard.writeText(e)}},mounted:function(){var e=this;_asyncToGenerator(_regenerator().m(function t(){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.startConnection();case 1:e.initializeApp();case 2:return t.a(2)}},t)}))(),window.addEventListener("beforeunload",this.handleBeforeUnload)},beforeUnmount:function(){window.removeEventListener("beforeunload",this.handleBeforeUnload),this.stream&&(this.stream.dispose(),this.stream=null),this.connection&&this.connection.stop()},template:n.messageTemplate}).mount(n.appElementSelector);console.error("The sendButtonElementSelector is required.")}else console.error("The inputElementSelector is required.");else console.error("The chatContainerElementSelector is required.");else console.error("The appElementSelector is required.");else console.error("The signalRHubUrl is required.")}}}(),window.downloadChart=function(e){var t=document.getElementById(e);if(t){var n=document.createElement("a");n.download="chart-"+e+".png",n.href=t.toDataURL("image/png"),n.click()}else console.error("Chart canvas not found:",e)},document.addEventListener("click",function(e){var t=e.target.closest(".ai-download-image");if(t){var n=t.closest(".generated-image-container"),r=null==n?void 0:n.querySelector("img");if(r){var o=r.src;o&&o.startsWith("data:")&&(e.preventDefault(),fetch(o).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t.getAttribute("download")||"generated-image.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(function(){URL.revokeObjectURL(n)},100)}).catch(function(e){console.error("Failed to download image:",e)}))}}});

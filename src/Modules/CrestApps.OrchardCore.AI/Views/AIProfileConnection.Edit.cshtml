@using CrestApps.OrchardCore.AI.ViewModels
@using OrchardCore

@model EditConnectionProfileViewModel

@if (Model.ConnectionNames?.Count > 1)
{
    <div class="@Orchard.GetWrapperClasses()" data-orchestrator-field="connection">
        <label asp-for="ConnectionName" class="@Orchard.GetLabelClasses()">@T["Connection name"]</label>
        <div class="@Orchard.GetEndClasses()">
            <select asp-for="ConnectionName" asp-items="Model.ConnectionNames" class="form-select">
                <option value="">@T["Default connection"]</option>
            </select>
            <span asp-validation-for="ConnectionName" class="text-danger"></span>
            <span class="hint">@T["The connection to use for this profile."]</span>
        </div>
    </div>
}
else
{
    <input type="hidden" asp-for="ConnectionName" />
}

@if (Model.Orchestrators?.Count > 1)
{
    <div class="@Orchard.GetWrapperClasses()">
        <label asp-for="OrchestratorName" class="@Orchard.GetLabelClasses()">@T["Orchestrator"]</label>
        <div class="@Orchard.GetEndClasses()">
            <select asp-for="OrchestratorName" asp-items="Model.Orchestrators" class="form-select" id="orchestrator-selector">
                <option value="">@T["Default orchestrator"]</option>
            </select>
            <span asp-validation-for="OrchestratorName" class="text-danger"></span>
            <span class="hint">@T["The orchestrator to use for this profile. The orchestrator controls how tools are selected and how the AI execution loop is managed."]</span>
        </div>
    </div>
}
else
{
    <input type="hidden" asp-for="OrchestratorName" />
}

<script at="Foot">
    document.addEventListener('DOMContentLoaded', function () {
        const orchestratorSelector = document.getElementById('orchestrator-selector');
        
        if (orchestratorSelector) {
            function updateFieldVisibility() {
                const selectedOrchestrator = orchestratorSelector.value || '';
                const isCopilot = selectedOrchestrator.toLowerCase() === 'copilot';
                
                // Hide/show connection field
                const connectionField = document.querySelector('[data-orchestrator-field="connection"]');
                if (connectionField) {
                    connectionField.style.display = isCopilot ? 'none' : '';
                }
                
                // Hide/show deployment field
                const deploymentField = document.querySelector('[data-orchestrator-field="deployment"]');
                if (deploymentField) {
                    deploymentField.style.display = isCopilot ? 'none' : '';
                }
                
                // Show/hide Copilot-specific fields
                const copilotFields = document.querySelector('[data-orchestrator-field="copilot"]');
                if (copilotFields) {
                    copilotFields.style.display = isCopilot ? '' : 'none';
                }
            }
            
            // Initial update
            updateFieldVisibility();
            
            // Update on change
            orchestratorSelector.addEventListener('change', updateFieldVisibility);
        }
    });
</script>

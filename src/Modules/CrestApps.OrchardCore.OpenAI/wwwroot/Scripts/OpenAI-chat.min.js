var openAIChatManager=function(){var e={messageTemplate:'\n            <div class="list-group">\n                <div v-for="(message, index) in messages" :key="index" class="list-group-item">\n                    <div class="d-flex">\n                        <div class="p-2">\n                            <i :class="message.role === \'user\' ? \'fa-solid fa-user fa-2xl text-primary\' : \'fa fa-robot fa-2xl text-success\'"></i>\n                        </div>\n                        <div class="p-2 lh-base">\n                            <h4 v-if="message.title">{{ message.title }}</h4>\n                            <div v-html="message.htmlContent || message.content"></div>\n                        </div>\n                    </div>\n                    <div class="d-flex justify-content-center message-buttons-container" v-if="message.role !== \'indicator\'">\n                        <button class="ms-2 btn btn-sm btn-outline-secondary button-message-toolbox" @click="copyResponse(message.content)" title="Click here to copy response to clipboard.">\n                            <i class="fa-solid fa-copy fa-lg"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ',indicatorTemplate:'<div class="spinner-grow spinner-grow-sm" role="status"><span class="visually-hidden">Loading...</span></div>'};return{initialize:function(t){var i=Object.assign({},e,t);if(i.chatUrl)if(i.appElementSelector)if(i.chatContainerElementSelector)if(i.inputElementSelector){if(i.sendButtonElementSelector)return Vue.createApp({data:function(){return{inputElement:null,buttonElement:null,chatContainer:null,placeholder:null,isSessionStarted:!1,isPlaceholderVisible:!0,chatWidgetStateName:null,chatWidgetStateSession:null,chatHistorySection:null,widgetIsInitialized:!1,messages:[],prompt:""}},methods:{addMessageInternal:function(e){var t=this;this.fireEvent(new CustomEvent("addingOpenAIPromotMessage",{detail:{message:e}})),this.messages.push(e),this.$nextTick((function(){t.fireEvent(new CustomEvent("addedOpenAIPromotMessage",{detail:{message:e}}))}))},addMessage:function(e){var t=this;this.addMessageInternal(e),this.hidePlaceholder(),this.$nextTick((function(){t.scrollToBottom()}))},addMessages:function(e){for(var t=this,i=0;i<e.length;i++)this.addMessageInternal(e[i]);this.hidePlaceholder(),this.$nextTick((function(){t.scrollToBottom()}))},hidePlaceholder:function(){this.placeholder&&this.placeholder.classList.add("d-none"),this.isPlaceholderVisible=!1},showPlaceholder:function(){this.placeholder&&this.placeholder.classList.remove("d-none"),this.isPlaceholderVisible=!0},handleUserInput:function(e){this.prompt=e.target.value},getProfileId:function(){return this.inputElement.getAttribute("data-profile-id")},resetSession:function(){this.inputElement.setAttribute("data-session-id",""),this.isSessionStarted=!1,this.widgetIsInitialized&&localStorage.removeItem(this.chatWidgetStateSession),this.messages=[],this.showPlaceholder()},initializeApp:function(){var e=this;this.inputElement=document.querySelector(i.inputElementSelector),this.buttonElement=document.querySelector(i.sendButtonElementSelector),this.chatContainer=document.querySelector(i.chatContainerElementSelector),this.placeholder=document.querySelector(i.placeholderElementSelector),this.inputElement.addEventListener("keyup",(function(t){"Enter"!==t.key||t.shiftKey||e.buttonElement.dispatchEvent(new Event("click"))})),this.inputElement.addEventListener("input",(function(t){e.handleUserInput(t),t.target.value.trim()?e.buttonElement.removeAttribute("disabled"):e.buttonElement.setAttribute("disabled",!0)})),this.buttonElement.addEventListener("click",(function(){e.sendMessage()}));for(var t=document.getElementsByClassName("profile-generated-prompt"),s=0;s<t.length;s++)t[s].addEventListener("click",(function(t){t.preventDefault(),e.generatePrompt(t.target)}));var n=document.getElementsByClassName("chat-session-history-item");for(s=0;s<n.length;s++)n[s].addEventListener("click",(function(t){t.preventDefault();var i=t.target.getAttribute("data-session-id");i?(e.loadSession(i),e.showChatScreen()):console.error("an element with the class chat-session-history-item with no data-session-id set.")}));for(var o=0;o<i.messages.length;o++)this.addMessage(i.messages[o])},reloadCurrentSession:function(){var e=this.getSessionId();e&&this.loadSession(e)},initializeWidget:function(){var e=this;if(i.widget.showChatButton)if(i.widget.chatWidgetContainer)if(i.widget.chatWidgetStateName){var t=document.querySelector(i.widget.showChatButton);if(t){var s=document.querySelector(i.widget.chatWidgetContainer);if(s){if(i.widget.chatHistorySection&&(this.chatHistorySection=document.querySelector(i.widget.chatHistorySection)),this.chatWidgetStateName=i.widget.chatWidgetStateName,this.chatWidgetStateSession=i.widget.chatWidgetStateName+"Session",this.widgetIsInitialized=!0,"open"===localStorage.getItem(this.chatWidgetStateName)&&(this.reloadCurrentSession(),s.classList.remove("d-none")),t.addEventListener("click",(function(){s.classList.contains("d-none")?(s.classList.remove("d-none"),localStorage.setItem(e.chatWidgetStateName,"open"),e.reloadCurrentSession()):(s.classList.add("d-none"),localStorage.setItem(e.chatWidgetStateName,"closed"))})),i.widget.closeChatButton){var n=document.querySelector(i.widget.closeChatButton);n&&n.addEventListener("click",(function(){s.classList.add("d-none"),localStorage.setItem(e.chatWidgetStateName,"closed")}))}if(i.widget.showHistoryButton&&this.chatHistorySection){var o=document.querySelector(i.widget.showHistoryButton);if(o&&o.addEventListener("click",(function(){e.chatHistorySection.classList.toggle("show")})),i.widget.closeHistoryButton){var a=document.querySelector(i.widget.closeHistoryButton);a&&a.addEventListener("click",(function(){e.showChatScreen()}))}}if(i.widget.newChatButton){var r=document.querySelector(i.widget.newChatButton);r&&r.addEventListener("click",(function(){e.resetSession(),e.showChatScreen()}))}}}}else console.error("The widget chatWidgetStateName is required.");else console.error("The widget chatWidgetContainer is required.");else console.error("The widget showChatButton is required.")},showChatScreen:function(){this.chatHistorySection&&this.chatHistorySection.classList.remove("show")},getSessionId:function(){var e=this.inputElement.getAttribute("data-session-id");return!e&&this.widgetIsInitialized&&(e=localStorage.getItem(this.chatWidgetStateSession)),e},copyResponse:function(e){navigator.clipboard.writeText(e)},sendMessage:function(){var e=this.prompt.trim();e&&(this.addMessage({role:"user",content:e}),this.showTypingIndicator(),this.inputElement.value="",this.prompt="",this.buttonElement.setAttribute("disabled",!0),this.completeChat(this.getProfileId(),e,this.getSessionId()))},generatePrompt:function(e){if(e){var t=e.getAttribute("data-profile-id"),i=this.getSessionId();t&&i?(this.showTypingIndicator(),this.completeChat(t,null,i)):console.error("The given element is missing data-profile-id or the session has not yet started.")}else console.error("The element paramter is required.")},completeChat:function(e,t,s){var n=this,o=this.getProfileId();fetch(i.chatUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:e,sessionId:s,prompt:t,sessionProfileId:o==e?null:o})}).then((function(e){if(!e.ok)throw new Error("Request failed with status ".concat(e.status));return e.json()})).then((function(e){n.initializeSession(e.sessionId,!1),n.addMessage(e.message),n.hideTypingIndicator()})).catch((function(e){console.error("Failed to send the message.",e),n.hideTypingIndicator()}))},createSessionUrl:function(e,t,i){var s=e.toLowerCase().startsWith("http")?e:window.location.origin+e,n=new URL(s);return n.searchParams.set(t,i),n.toString()},loadSession:function(e){var t=this;if(i.widget.sessionUrl){var s=this.createSessionUrl(i.widget.sessionUrl,"sessionId",e);fetch(s,{method:"GET"}).then((function(e){if(!e.ok)throw new Error("Request failed with status ".concat(e.status));return e.json()})).then((function(e){var i;t.initializeSession(e.sessionId,!0),t.messages=null!==(i=e.messages)&&void 0!==i?i:[],t.messages.length?t.hidePlaceholder():t.showPlaceholder(),t.$nextTick((function(){t.scrollToBottom()}))})).catch((function(e){console.error("Failed to load session.",e),t.hideTypingIndicator()}))}else console.error("The sessionUrl is required.")},fireEvent:function(e){document.dispatchEvent(e)},initializeSession:function(e,t){this.isSessionStarted&&!t||(this.fireEvent(new CustomEvent("initializingSessionOpenAIChat",{detail:{sessionId:e}})),this.inputElement.setAttribute("data-session-id",e),this.isSessionStarted=!0,this.widgetIsInitialized&&localStorage.setItem(this.chatWidgetStateSession,e))},showTypingIndicator:function(){this.addMessage({role:"indicator",htmlContent:i.indicatorTemplate})},hideTypingIndicator:function(){this.messages=this.messages.filter((function(e){return"indicator"!=e.role}))},scrollToBottom:function(){var e=this;setTimeout((function(){e.chatContainer.scrollTop=e.chatContainer.scrollHeight-e.chatContainer.clientHeight}),50)}},mounted:function(){this.initializeApp(),i.widget&&this.initializeWidget()},template:i.messageTemplate}).mount(i.appElementSelector);console.error("The sendButtonElementSelector is required.")}else console.error("The inputElementSelector is required.");else console.error("The chatContainerElementSelector is required.");else console.error("The appElementSelector is required.");else console.error("The chatUrl is required.")}}}();

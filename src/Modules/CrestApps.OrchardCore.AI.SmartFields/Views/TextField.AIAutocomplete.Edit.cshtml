@using CrestApps.OrchardCore.AI.SmartFields.ViewModels
@using OrchardCore
@using OrchardCore.ContentFields.Settings
@using OrchardCore.ContentManagement.Metadata.Models

@model EditSmartTextFieldViewModel

@{
    var settings = Model.PartFieldDefinition.GetSettings<TextFieldSettings>();
    var id = Html.IdFor(m => m.Text);
    var uniqueId = $"smart-text-field-{id}";
    var isRequired = settings.Required;
}

<div class="mb-3 position-relative" asp-validation-class-for="Text">
    <label asp-for="Text" class="form-label">@Model.PartFieldDefinition.DisplayName()</label>
    <div class="position-relative">
        @if (isRequired)
        {
            <input type="text"
                   class="form-control smart-text-autocomplete"
                   asp-for="Text"
                   autocomplete="off"
                   data-profile-id="@Model.ProfileId"
                   data-wrapper-id="@uniqueId"
                   required />
        }
        else
        {
            <input type="text"
                   class="form-control smart-text-autocomplete"
                   asp-for="Text"
                   autocomplete="off"
                   data-profile-id="@Model.ProfileId"
                   data-wrapper-id="@uniqueId" />
        }
        <div id="@uniqueId-suggestions" class="smart-autocomplete-suggestions dropdown-menu w-100" style="display: none;"></div>
        <div id="@uniqueId-spinner" class="smart-autocomplete-spinner" style="display: none;">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">@T["Loading..."]</span>
            </div>
        </div>
    </div>
    @if (!string.IsNullOrEmpty(Model.Hint))
    {
        <span class="hint">@Model.Hint</span>
    }
    <span asp-validation-for="Text"></span>
</div>

<style asp-name="smart-text-field"></style>
<script asp-name="smart-text-field" at="Foot" depends-on="jQuery"></script>

<script at="Foot">
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof smartTextFieldManager !== 'undefined') {
            smartTextFieldManager.initialize('@id', '@Model.ProfileId', '@uniqueId');
        }
    });
</script>

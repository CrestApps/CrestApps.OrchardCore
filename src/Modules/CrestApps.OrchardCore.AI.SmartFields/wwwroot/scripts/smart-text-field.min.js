window.smartTextFieldManager=function(){"use strict";var e={},n={},t=3,r=500;function i(n,t){var r=e[n];t.forEach((function(e,n){n===r.selectedIndex?e.classList.add("active"):e.classList.remove("active")}))}function s(n,t){var r=e[n];if(r){r.input.value=t,o(n);var i=new Event("input",{bubbles:!0});r.input.dispatchEvent(i)}}function o(n){var t=e[n];t&&t.suggestionsContainer&&(t.suggestionsContainer.style.display="none",t.suggestionsContainer.innerHTML="",t.selectedIndex=-1)}function a(n){var t=e[n];t&&t.spinnerContainer&&(t.spinnerContainer.style.display="none")}return{initialize:function(c,u,d){var l=document.getElementById(c);if(l&&!e[c]){var f=document.getElementById(d+"-suggestions"),g=document.getElementById(d+"-spinner");f?(e[c]={input:l,profileId:u,suggestionsContainer:f,spinnerContainer:g,selectedIndex:-1},l.addEventListener("input",(function(i){!function(i,c){var u=e[i];if(!u)return;n[i]&&clearTimeout(n[i]);if(!c||c.length<t)return void o(i);n[i]=setTimeout((function(){!function(n,t){var r=e[n];if(!r)return;!function(n){var t=e[n];t&&t.spinnerContainer&&(t.spinnerContainer.style.display="block")}(n);var i={profileId:r.profileId,prompt:t};fetch("/api/ai/completion/utility",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(t){a(n),t&&t.success&&t.message&&t.message.content?function(n,t){var r=e[n];if(!r||!t||0===t.length)return void o(n);r.suggestionsContainer.innerHTML="",r.selectedIndex=-1,t.forEach((function(e){var t=document.createElement("a");t.className="dropdown-item",t.href="#",t.textContent=e,t.addEventListener("click",(function(t){t.preventDefault(),s(n,e)})),t.addEventListener("mouseenter",(function(){var e=r.suggestionsContainer.querySelectorAll(".dropdown-item");e.forEach((function(e){e.classList.remove("active")})),t.classList.add("active"),r.selectedIndex=Array.from(e).indexOf(t)})),r.suggestionsContainer.appendChild(t)})),r.suggestionsContainer.style.display="block"}(n,function(e){try{var n=JSON.parse(e);if(Array.isArray(n))return n.filter((function(e){return"string"==typeof e&&e.trim().length>0}));if(n.suggestions&&Array.isArray(n.suggestions))return n.suggestions}catch(e){}return e.split(/[\n,]/).map((function(e){return e.replace(/^[\d\.\-\*\s]+/,"").trim()})).filter((function(e){return e.length>0&&e.length<200})).slice(0,10)}(t.message.content)):o(n)})).catch((function(e){console.error("Error fetching suggestions:",e),a(n),o(n)}))}(i,c)}),r)}(c,i.target.value)})),l.addEventListener("keydown",(function(n){!function(n,t){var r=e[n];if(!r)return;var a=r.suggestionsContainer.querySelectorAll(".dropdown-item");if(0===a.length)return;switch(t.key){case"ArrowDown":t.preventDefault(),r.selectedIndex=Math.min(r.selectedIndex+1,a.length-1),i(n,a);break;case"ArrowUp":t.preventDefault(),r.selectedIndex=Math.max(r.selectedIndex-1,0),i(n,a);break;case"Enter":r.selectedIndex>=0&&a[r.selectedIndex]&&(t.preventDefault(),s(n,a[r.selectedIndex].textContent));break;case"Escape":o(n)}}(c,n)})),l.addEventListener("blur",(function(){setTimeout((function(){o(c)}),200)})),document.addEventListener("click",(function(e){l.contains(e.target)||f.contains(e.target)||o(c)}))):console.warn("Suggestions container not found for:",d)}}}}();
